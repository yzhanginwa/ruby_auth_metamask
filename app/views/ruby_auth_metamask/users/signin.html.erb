<div class="h-screen flex justify-center items-center">
  <div class="w-2/3 grid gap-y-4 sm:text-xl lg:text-2xl bg-gray-200 m-4 px-4 py-10 rounded-xl ">
    <div class="">Please install MetaMask extension first</div>
    <div class="">Invoke metamask to sign a random message</div>
    <div class="">You're ready to sign in to the server</div>
    <div class="flex justfy-center mt-20">
      <hr class="h-px my-8 bg-gray-200 border-0 dark:bg-gray-700">
      <button class="w-1/2 mx-auto rounded-lg bg-orange-300 p-3">Log In</button>
    </div>
  </div>
</div>


<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@1.3.6/dist/web3.min.js"></script>

<script type="module">
  import stimulus-use from https://cdn.jsdelivr.net/npm/stimulus-use@0.52.1/+esm
</script>

<script>

  import {Controller} from "stimulus";

  if (! window.ethereum) {
alert("aaaa");
  }

// Check if MetaMask is installed
if (window.ethereum) {
    // Use MetaMask provider
    const web3 = new Web3(window.ethereum);

    // Request account access
    window.ethereum.request({ method: 'eth_requestAccounts' })
        .then(accounts => {
            const accountAddress = accounts[0];
            console.log('Account Address:', accountAddress);

            // Now you can use this address for further operations


          const message = "<%= @message %>";
            const fromAddress = accountAddress;

            web3.eth.personal.sign(message, fromAddress, (error, signature) => {
                if (!error) {
                    console.log("Signature: ", signature);
                    // Handle the signature as needed
                } else {
                    console.error("Error signing message: ", error);
                }
            });


        })
        .catch(error => {
            console.error('Error requesting accounts:', error);
        });
} else {
    console.error('MetaMask not detected. Please install MetaMask extension.');
}

</script>
